-- UILibrary.lua (corrigido e aprimorado)

local UILibrary = {}
UILibrary.__index = UILibrary

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

-- Criação suave de Drag
local function MakeDraggable(frame)
	local dragging, dragInput, dragStart, startPos

	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)

	frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
	end)

	RunService.RenderStepped:Connect(function()
		if dragging and dragInput then
			local delta = UserInputService:GetMouseLocation() - dragStart
			frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- Cria a Janela
function UILibrary:CreateWindow(title)
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "CustomUILib"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.IgnoreGuiInset = true
	ScreenGui.Parent = game.CoreGui

	local MainFrame = Instance.new("Frame")
	MainFrame.Name = "MainFrame"
	MainFrame.Size = UDim2.new(0, 600, 0, 400)
	MainFrame.Position = UDim2.new(0.5, -300, 0.5, -200)
	MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	MainFrame.BorderSizePixel = 0
	MainFrame.Active = true
	MainFrame.Parent = ScreenGui
	MakeDraggable(MainFrame)

	-- Toggle UI com RightCtrl
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if input.KeyCode == Enum.KeyCode.RightControl then
			MainFrame.Visible = not MainFrame.Visible
		end
	end)

	-- Título
	local TitleBar = Instance.new("TextLabel")
	TitleBar.Size = UDim2.new(1, 0, 0, 30)
	TitleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	TitleBar.Text = title or "Window"
	TitleBar.TextColor3 = Color3.new(1, 1, 1)
	TitleBar.Font = Enum.Font.Arcade
	TitleBar.TextSize = 20
	TitleBar.Parent = MainFrame

	-- Área de Botões das Abas
	local TabButtons = Instance.new("Frame")
	TabButtons.Size = UDim2.new(0, 120, 1, -30)
	TabButtons.Position = UDim2.new(0, 0, 0, 30)
	TabButtons.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	TabButtons.ZIndex = 2
	TabButtons.Parent = MainFrame

	-- Área de Conteúdo
	local ContentFrame = Instance.new("Frame")
	ContentFrame.Size = UDim2.new(1, -250, 1, -30)
	ContentFrame.Position = UDim2.new(0, 120, 0, 30)
	ContentFrame.BackgroundTransparency = 1
	ContentFrame.Name = "ContentFrame"
	ContentFrame.ClipsDescendants = true
	ContentFrame.Parent = MainFrame

	-- Painel de Infos do Player
	local InfoPanel = Instance.new("Frame")
	InfoPanel.Size = UDim2.new(0, 130, 1, -30)
	InfoPanel.Position = UDim2.new(1, -130, 0, 30)
	InfoPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	InfoPanel.Parent = MainFrame

	local InfoTitle = Instance.new("TextLabel")
	InfoTitle.Size = UDim2.new(1, 0, 0, 20)
	InfoTitle.Text = "PLAYER INFO"
	InfoTitle.TextColor3 = Color3.new(1, 1, 1)
	InfoTitle.BackgroundTransparency = 1
	InfoTitle.Font = Enum.Font.Arcade
	InfoTitle.TextSize = 14
	InfoTitle.Parent = InfoPanel

	-- Aqui vamos adicionar os dados do player e o sistema de busca depois

	local self = setmetatable({}, UILibrary)
	self.MainFrame = MainFrame
	self.Tabs = {}
	self.CurrentTab = nil
	self.TabButtons = TabButtons
	self.ContentFrame = ContentFrame
	self.InfoPanel = InfoPanel

	return self
end

-- Cria uma nova aba
function UILibrary:CreateTab(name)
	local TabButton = Instance.new("TextButton")
	TabButton.Size = UDim2.new(1, 0, 0, 30)
	TabButton.Text = name
	TabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	TabButton.TextColor3 = Color3.new(1, 1, 1)
	TabButton.Font = Enum.Font.Arcade
	TabButton.TextSize = 18
	TabButton.Parent = self.TabButtons

	local TabContent = Instance.new("ScrollingFrame")
	TabContent.Size = UDim2.new(1, 0, 1, 0)
	TabContent.CanvasSize = UDim2.new(0, 0, 10, 0)
	TabContent.BackgroundTransparency = 1
	TabContent.Visible = false
	TabContent.ScrollBarThickness = 4
	TabContent.Parent = self.ContentFrame

	TabButton.MouseButton1Click:Connect(function()
		if self.CurrentTab then
			self.CurrentTab.Visible = false
		end
		self.CurrentTab = TabContent
		TabContent.Visible = true
	end)

	self.Tabs[name] = { Button = TabButton, Content = TabContent }

	if not self.CurrentTab then
		self.CurrentTab = TabContent
		TabContent.Visible = true
	end

	return TabContent
end

return UILibrary
